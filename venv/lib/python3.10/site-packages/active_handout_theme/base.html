<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% block htmltitle %}
      {% if page.meta and page.meta.title %}
        <title>{{ page.meta.title }} - {{ config.site_name }}</title>
      {% elif page.title and not page.is_homepage %}
        <title>{{ page.title | striptags }} - {{ config.site_name }}</title>
      {% else %}
        <title>{{ config.site_name }}</title>
      {% endif %}
    {% endblock %}
    <link rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Fira+Sans+Extra+Condensed:700|Oxygen+Mono|Source+Sans+Pro:700|Source+Serif+Pro&amp;display=swap">
    <link rel="stylesheet" href="{{ 'assets/css/main.css' | url }}">
    <script>
      // SETUP GLOBAL CONSTANTS
      var base_url = '{{ base_url }}';
      {% if config.active_handout.telemetry %}
      var telemetryEnabled = true;
      var backendUrl = "{{ config.active_handout.backend_url }}";
      var courseSlug = "{{ config.COURSE_SLUG }}";
      {% else %}
      var telemetryEnabled = false;
      var backendUrl = "";
      var courseSlug = "";
      {% endif %}
      {% if config.active_handout.tag_tree %}
      var dashboardEnabled = true;
      var tagTree = {{ config.active_handout.tag_tree }};
      {% else %}
      var dashboardEnabled = false;
      var tagTree = {};
      {% endif %}

      // SETUP PLUGIN
      window.initialized = false;
      if (!window.initializers) window.initializers = [];
      window.registerInitializer = (initialize) => {
        if (window.initialized) initialize();
        else window.initializers.push(initialize);
      };
    </script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true
        }
      });
    </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="https://unpkg.com/hyperscript.org"></script>
    <script src="https://unpkg.com/htmx.org@1.8.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="{{ 'assets/js/main.js'|url }}"></script>
    {% block extrahead %}{% endblock %}
    {% for path in config.extra_css %}<link rel="stylesheet" href="{{ path | url }}">{% endfor %}
  </head>
  <body>
    <div class="ah-main-container">
      <header class="ah-header">
        <button class="ah-menu-btn ah-button ah-button--borderless"
                aria-label="toggle menu">
          {% include 'icon/menu.svg' %}
        </button>
        <a href="{{ config.extra.homepage | d(nav.homepage.url, true) | url }}"
           title="{{ config.site_name | e }}"
           class="ah-logo"
           aria-label="{{ config.site_name }}">
          {{ config.site_name | e }}
        </a>
        <div class="ah-header--right">
          {% set show_reset_button=True %}
          {% if page.meta and page.meta.show_reset_button is defined %}
          {% set show_reset_button=page.meta.show_reset_button %}
          {%endif%}
          {% if show_reset_button %}
          <button id="resetHandoutButton">
            <span class="icon">{% include "icon/trash.svg" %}</span>
          </button>
          {% endif %}

          {% if config.active_handout.telemetry %}
          <div id="user-menu" hx-get="{{ config.active_handout.backend_user_menu_url }}" hx-trigger="load"> </div>
          {% endif %}
        </div>
      </header>
      <nav class="ah-navigation preload">
        <div class="ah-nav-container">
          <button class="ah-menu-btn ah-button ah-button--borderless close-menu"
                  aria-label="close menu">
            {% include 'icon/cross.svg' %}
          </button>
          <ul class="ah-nav-body">
            {% for nav_item in nav %}
              {% include "nav.html" %}
            {% endfor %}
          </ul>
        </div>
      </nav>
      <main class="ah-content ah-typeset">
        {% block content %}
          <div class="ah-title-box">
            <ul class="ah-breadcrumbs">
              {% if page %}
                {% for doc in page.ancestors[::-1] %}
                  {% if doc.link %}
                    <li>
                      <a href="{{ doc.link|e }}">{{ doc.title }}</a>
                    </li>
                  {% else %}
                    <li>{{ doc.title }}</li>
                  {% endif %}
                {% endfor %}
                <li></li>
              {%- endif %}
            </ul>
            {% if page.meta and page.meta.title %}<h1>{{ page.meta.title }}</h1>{% endif %}
            {% if page.meta and page.meta.subtitle %}<h2>{{ page.meta.subtitle }}</h2>{% endif %}
          </div>
          {% if page.meta and page.meta.force_login %}
            <div id="content-behind-login" class="hidden">
              {{ page.content }}
            </div>
            <div id="login-needed-message">
              {% trans %}Sign in to access this page.{% endtrans %}
            </div>
          {% else %}
            {{ page.content }}
          {% endif %}
        {% endblock %}
      </main>
      <footer class="ah-footer ah-typeset">
        <div class="ah-footer-nav">
          {% if page.previous_page %}
            <a href="{{ page.previous_page.url|url }}"
               class="ah-prev"
               title="{{ page.previous_page.title }}">
              <span class="nav-label">{% trans %}Previous{% endtrans %}</span>
              <span class="nav-title">{{ page.previous_page.title }}</span>
            </a>
          {% endif %}
          {% if page.next_page %}
            <a href="{{ page.next_page.url|url }}"
               class="ah-next"
               title="{{ page.next_page.title }}">
              <span class="nav-label">{% trans %}Next{% endtrans %}</span>
              <span class="nav-title">{{ page.next_page.title }}</span>
            </a>
          {% endif %}
        </div>
      </footer>
    </div>
    {% block scripts %}
      {% for path in config.extra_javascript %}<script src="{{ path | url }}"></script>{% endfor %}
    {% endblock %}
  </body>
</html>
